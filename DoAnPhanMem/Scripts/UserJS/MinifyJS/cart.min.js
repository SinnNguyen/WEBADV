function reGex() { return regex = /(\d)(?=(\d{3})+(?!\d))/g } function Update_quan_mouse_ev() { var e = $(".qty-input").data("id"); $(".btn-inc").removeClass("no-pointer-events"); var t = $(".qty-input").val(); "" != t && (Cookie.set("product_" + e, t, 30), updateOrderPrice()) } function updateOrderPrice() { $(".lblCartCount").text(Cookie.countProduct()); var e, t = $("input.qty-input"), n = 0; t.each(function (e, t) { var r = Number($(t).data("price")), i = Number($(t).val()); n += r * i }); var r = $("#discount"), i = 0; null == r.attr("data-price") ? e = n + 3e4 : r.attr("data-price") < n ? (i = Number(r.attr("data-price")), e = n + 3e4 - i) : (i = Number(r.attr("data-price")), e = 3e4), e += "", n += "", i += "", reGex(), $(".totalPrice").text(n.replace(regex, "$1.") + "₫"), $(".totalPriceWithFee").text(e.replace(regex, "$1.") + "₫"), $("#discount").text(i.replace(regex, "$1.") + "₫") } $(".qty-input").mouseleave(function () { Update_quan_mouse_ev() }), $(".qty-input").mouseover(function () { Update_quan_mouse_ev() }), $(".qty-input").change(function (e) { Update_quan_mouse_ev() }), $(".qty-input").mouseout(function (e) { Update_quan_mouse_ev() }), $(".btn-dec").click(function (e) { $(".btn-inc").removeClass("no-pointer-events"); var t = $(e.currentTarget).next(), n = t.data("id"), r = t.data("price"), i = Number(t.val()); if (i > 1) { i -= 1, Cookie.set("product_" + n, i, 30), t.val(i), updateOrderPrice(); var o = 0; o = i * r, o += "", $("#total3-" + n).text(o.replace(regex, "$1.") + "₫") } }), $(".btn-inc").click(function (e) { var t = $(e.currentTarget).prev(), n = t.data("quan"), r = t.data("id"), i = t.data("price"), o = Number(t.val()); if (o < 1) o = 1, Cookie.set("product_" + r, o, 30), t.val(o), updateOrderPrice(); else if (o >= n) { $(".btn-inc").addClass("no-pointer-events"), Swal.mixin({ toast: !0, position: "top-end", showConfirmButton: !1, timer: 2e3, didOpen: e => { e.addEventListener("mouseenter", Swal.stopTimer), e.addEventListener("mouseleave", Swal.resumeTimer) } }).fire({ icon: "error", title: "Số lượng đã đạt giới hạn" }) } else { o += 1, Cookie.set("product_" + r, o, 10), t.val(o), updateOrderPrice(), reGex(); var a = 0; a = o * i, a += "", $("#total3-" + r).text(a.replace(regex, "$1.") + "₫") } }), $(".js-delete").click(function (e) { Swal.fire({ title: "Xác nhận xóa?", text: "Xóa sản phẩm khỏi giỏ hàng", icon: "warning", showCancelButton: !0, cancelButtonColor: "#d33", confirmButtonColor: "#3085d6", cancelButtonText: "Hủy", confirmButtonText: "Xác nhận!", reverseButtons: !0 }).then(t => { if (t.isConfirmed) { var n = $(e.currentTarget).data("id"); $(e.currentTarget).closest(".item").remove(), Cookie.remove("product_" + n); var r = Cookie.countWithPrefix("product"); $("#cartCount").text(r), $(".lblCartCount").text(0 == r ? "0" : r), $("#emty-product").attr("class", 0 == r ? "d-block" : "d-none"), updateOrderPrice(), Swal.mixin({ toast: !0, position: "top-end", showConfirmButton: !1, timer: 1500, didOpen: e => { e.addEventListener("mouseenter", Swal.stopTimer), e.addEventListener("mouseleave", Swal.resumeTimer) } }).fire({ icon: "success", title: "Xóa thành công" }) } }) }), $(".js-checkout").click(function (e) { e.preventDefault(); var t = Cookie.countWithPrefix("product"); $.get("/Account/UserLogged", {}, function (n, r, i) { if (n) if (0 == t) { Swal.mixin({ toast: !0, position: "top", showConfirmButton: !1, timer: 1500, didOpen: e => { e.addEventListener("mouseenter", Swal.stopTimer), e.addEventListener("mouseleave", Swal.resumeTimer) } }).fire({ icon: "error", title: "Giỏ hàng chưa có sản phẩm!" }) } else location.href = e.currentTarget.href; else Swal.fire({ title: "Yêu cầu đăng nhập?", text: "Vui lòng đăng nhập để thực hiện được chức năng này", icon: "error", showCancelButton: !0, cancelButtonColor: "#d33", confirmButtonColor: "#3085d6", cancelButtonText: "Hủy", confirmButtonText: "Đăng nhập", reverseButtons: !0 }).then(e => { e.isConfirmed && (location.href = "login") }) }, "json") }), $(".btn-submitcoupon").click(function (e) { var t = $(e.currentTarget).prev().val().trim(); t.length && $.getJSON("/cart/UseDiscountCode", { code: t }, function (e, t, n) { if (e.success) { $("#discount").attr("data-price", e.discountPrice), $("#discount").attr("class", "text-success"), updateOrderPrice(), Swal.mixin({ toast: !0, position: "top-end", showConfirmButton: !1, timer: 2500, didOpen: e => { e.addEventListener("mouseenter", Swal.stopTimer), e.addEventListener("mouseleave", Swal.resumeTimer) } }).fire({ icon: "success", title: "Mã giảm giá đã được áp dụng thành công!" }) } else { Swal.mixin({ toast: !0, position: "top-end", showConfirmButton: !1, timer: 2500, didOpen: e => { e.addEventListener("mouseenter", Swal.stopTimer), e.addEventListener("mouseleave", Swal.resumeTimer) } }).fire({ icon: "error", title: "Lỗi! Vui lòng kiểm tra lại" }) } }) });